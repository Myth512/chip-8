#include "../include/memory.h"

const u8 font[] = {
    0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
    0x20, 0x60, 0x20, 0x20, 0x70, // 1
    0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
    0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
    0x90, 0x90, 0xF0, 0x10, 0x10, // 4  
    0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
    0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
    0xF0, 0x10, 0x20, 0x40, 0x40, // 7
    0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
    0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
    0xF0, 0x90, 0xF0, 0x90, 0x90, // A
    0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
    0xF0, 0x80, 0x80, 0x80, 0xF0, // C
    0xE0, 0x90, 0x90, 0x90, 0xE0, // D
    0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
    0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

const u8 large_font[] = {
    0x3C, 0x7E, 0xC7, 0xCF, 0xDF, 0xDB, 0xFB, 0xE3, 0x7E, 0x3C, // 0
    0x18, 0x78, 0xF8, 0xD8, 0x18, 0x18, 0x18, 0x18, 0xFF, 0xFF, // 1
    0x7C, 0xFF, 0xC3, 0x03, 0x3F, 0x7D, 0xE0, 0xC0, 0xFF, 0xFF, // 2
    0x7C, 0xFF, 0xC3, 0x03, 0x3E, 0x3E, 0x03, 0xC3, 0xFF, 0x7C, // 3
    0x0F, 0x1F, 0x3B, 0x73, 0xD3, 0xC3, 0xFF, 0xFF, 0x03, 0x03, // 4
    0xFF, 0xFF, 0xC0, 0xC0, 0xFE, 0xFF, 0x03, 0xC3, 0xFF, 0x7E, // 5
    0x7E, 0xFF, 0xC3, 0xC0, 0xFE, 0xFF, 0xC3, 0xC3, 0xFF, 0x7E, // 6
    0xFF, 0xFF, 0xC3, 0x03, 0x06, 0x06, 0x0C, 0x0C, 0x18, 0x18, // 7
    0x7E, 0xFF, 0xC3, 0xE7, 0x7E, 0x7E, 0xE7, 0xC3, 0xFF, 0x7E, // 8
    0x7C, 0xFE, 0xC6, 0xC6, 0xFE, 0x7E, 0x06, 0xC6, 0xFE, 0x7C  // 9
};

void memory_initialize(Memory *memory)
{
memset(memory, 0, sizeof(Memory));

    memcpy(memory->RAM + FONT_OFFSET, font, 80);
    memcpy(memory->RAM + FONT_OFFSET + 80, large_font, 100);

	memory->PC = BASE_ADDRESS;
	return;
}

bool memory_rom_read(int argc, char *argv[], Memory *memory)
{
	if (argc < 2)
    {
		fprintf(stderr, "Rom file is not provided.\n");	
		return false;
	}

	FILE *file = fopen(argv[1], "rb");
	if (!file)
    {
		fprintf(stderr, "Could not read rom.\n");
		return false;
	}
	
	fseek(file, 0, SEEK_END);
	int size = ftell(file);
	fseek(file, 0, SEEK_SET);
	
	fread(memory->RAM + BASE_ADDRESS, 8, size, file);
	return true;
}	
